# =====================================
# ðŸš€ DEPLOYMENTS - BLASTNODES COMPLETO
# Con Prometheus + Grafana integrados
# y nodos usando kevf20/tcp-node-metrics
# =====================================

apiVersion: apps/v1
kind: Deployment
metadata:
  name: prometheus
  labels:
    app: prometheus
spec:
  replicas: 1
  selector:
    matchLabels:
      app: prometheus
  template:
    metadata:
      labels:
        app: prometheus
    spec:
      containers:
        - name: prometheus
          image: prom/prometheus:latest
          ports:
            - containerPort: 9090
          command:
            - '/bin/prometheus'
            - '--config.file=/etc/prometheus/prometheus.yml'
            - '--storage.tsdb.path=/prometheus'
            - '--web.enable-lifecycle'
            - '--storage.tsdb.retention.time=1y'
          volumeMounts:
            - name: prometheus-config
              mountPath: /etc/prometheus/prometheus.yml
      volumes:
        - name: prometheus-config
          hostPath:
            path: /home/kevf20/BLASTNODES/prometheus.yml
            type: File
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: grafana
  labels:
    app: grafana
spec:
  replicas: 1
  selector:
    matchLabels:
      app: grafana
  template:
    metadata:
      labels:
        app: grafana
    spec:
      containers:
        - name: grafana
          image: grafana/grafana:latest
          ports:
            - containerPort: 3000
          env:
            - name: GF_SECURITY_ADMIN_PASSWORD
              value: "admin"
            - name: GF_SECURITY_ADMIN_USER
              value: "admin"
            - name: GF_AUTH_ANONYMOUS_ENABLED
              value: "true"
            - name: GF_AUTH_ANONYMOUS_ORG_ROLE
              value: "Admin"
            - name: GF_PATHS_PROVISIONING
              value: "/etc/grafana/provisioning"
            - name: GF_INSTALL_PLUGINS
              value: "agenty-flowcharting-panel"
          volumeMounts:
            - name: grafana-provisioning
              mountPath: /etc/grafana/provisioning
            - name: grafana-dashboards
              mountPath: /var/lib/grafana/dashboards
      volumes:
        - name: grafana-provisioning
          hostPath:
            path: /home/kevf20/BLASTNODES/Grafana/provisioning
            type: Directory
        - name: grafana-dashboards
          hostPath:
            path: /home/kevf20/BLASTNODES/Grafana/dashboards
            type: Directory

---
# =====================================
# ðŸ”¥ 10 NODOS - kevf20/tcp-node-metrics
# =====================================

apiVersion: apps/v1
kind: Deployment
metadata:
  name: node1
  labels:
    app: node1
spec:
  replicas: 1
  selector:
    matchLabels: { app: node1 }
  template:
    metadata:
      labels: { app: node1 }
    spec:
      containers:
        - name: node1
          image: kevf20/tcp-node-metrics:latest
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 5000
            - containerPort: 8000
          env:
            - { name: SELF_NAME, value: "node1" }
            - { name: PORT, value: "5000" }
            - { name: METRICS_PORT, value: "8000" }
            - { name: PEERS, value: "node2" }
            - { name: DESTINOS, value: "node8" }
            - { name: ROUTES, value: "node3:node2,node4:node2,node5:node2,node6:node2,node7:node2,node8:node2,node9:node2,node10:node2" }
          readinessProbe:
            tcpSocket: { port: 5000 }
            initialDelaySeconds: 3
            periodSeconds: 5
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: node2
  labels:
    app: node2
spec:
  replicas: 1
  selector:
    matchLabels: { app: node2 }
  template:
    metadata:
      labels: { app: node2 }
    spec:
      containers:
        - name: node2
          image: kevf20/tcp-node-metrics:latest
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 5000
            - containerPort: 8000
          env:
            - { name: SELF_NAME, value: "node2" }
            - { name: PORT, value: "5000" }
            - { name: METRICS_PORT, value: "8000" }
            - { name: PEERS, value: "node1,node4,node6,node5,node10" }
            - { name: ROUTES, value: "node3:node4,node8:node6,node9:node5,node7:node6" }
          readinessProbe:
            tcpSocket: { port: 5000 }
            initialDelaySeconds: 3
            periodSeconds: 5
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: node3
  labels:
    app: node3
spec:
  replicas: 1
  selector:
    matchLabels: { app: node3 }
  template:
    metadata:
      labels: { app: node3 }
    spec:
      containers:
        - name: node3
          image: kevf20/tcp-node-metrics:latest
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 5000
            - containerPort: 8000
          env:
            - { name: SELF_NAME, value: "node3" }
            - { name: PORT, value: "5000" }
            - { name: METRICS_PORT, value: "8000" }
            - { name: PEERS, value: "node4,node6" }
            - { name: ROUTES, value: "node1:node4,node2:node4,node5:node6,node7:node6,node8:node6,node9:node6,node10:node4" }
          readinessProbe:
            tcpSocket: { port: 5000 }
            initialDelaySeconds: 3
            periodSeconds: 5
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: node4
  labels:
    app: node4
spec:
  replicas: 1
  selector:
    matchLabels: { app: node4 }
  template:
    metadata:
      labels: { app: node4 }
    spec:
      containers:
        - name: node4
          image: kevf20/tcp-node-metrics:latest
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 5000
            - containerPort: 8000
          env:
            - { name: SELF_NAME, value: "node4" }
            - { name: PORT, value: "5000" }
            - { name: METRICS_PORT, value: "8000" }
            - { name: PEERS, value: "node3,node2" }
            - { name: ROUTES, value: "node1:node2,node5:node2,node6:node3,node7:node3,node8:node3,node9:node3,node10:node2" }
          readinessProbe:
            tcpSocket: { port: 5000 }
            initialDelaySeconds: 3
            periodSeconds: 5
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: node5
  labels:
    app: node5
spec:
  replicas: 1
  selector:
    matchLabels: { app: node5 }
  template:
    metadata:
      labels: { app: node5 }
    spec:
      containers:
        - name: node5
          image: kevf20/tcp-node-metrics:latest
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 5000
            - containerPort: 8000
          env:
            - { name: SELF_NAME, value: "node5" }
            - { name: PORT, value: "5000" }
            - { name: METRICS_PORT, value: "8000" }
            - { name: PEERS, value: "node2,node9,node6" }
            - { name: ROUTES, value: "node10:node9,node1:node2,node4:node2,node3:node6,node7:node9,node8:node6" }
          readinessProbe:
            tcpSocket: { port: 5000 }
            initialDelaySeconds: 3
            periodSeconds: 5
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: node6
  labels:
    app: node6
spec:
  replicas: 1
  selector:
    matchLabels: { app: node6 }
  template:
    metadata:
      labels: { app: node6 }
    spec:
      containers:
        - name: node6
          image: kevf20/tcp-node-metrics:latest
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 5000
            - containerPort: 8000
          env:
            - { name: SELF_NAME, value: "node6" }
            - { name: PORT, value: "5000" }
            - { name: METRICS_PORT, value: "8000" }
            - { name: PEERS, value: "node2,node3,node5,node7,node8" }
            - { name: ROUTES, value: "node9:node5,node10:node2,node1:node2,node4:node3" }
          readinessProbe:
            tcpSocket: { port: 5000 }
            initialDelaySeconds: 3
            periodSeconds: 5
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: node7
  labels:
    app: node7
spec:
  replicas: 1
  selector:
    matchLabels: { app: node7 }
  template:
    metadata:
      labels: { app: node7 }
    spec:
      containers:
        - name: node7
          image: kevf20/tcp-node-metrics:latest
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 5000
            - containerPort: 8000
          env:
            - { name: SELF_NAME, value: "node7" }
            - { name: PORT, value: "5000" }
            - { name: METRICS_PORT, value: "8000" }
            - { name: PEERS, value: "node6,node8,node9" }
            - { name: ROUTES, value: "node1:node6,node2:node6,node3:node6,node4:node6,node5:node9,node10:node9" }
          readinessProbe:
            tcpSocket: { port: 5000 }
            initialDelaySeconds: 3
            periodSeconds: 5
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: node8
  labels:
    app: node8
spec:
  replicas: 1
  selector:
    matchLabels: { app: node8 }
  template:
    metadata:
      labels: { app: node8 }
    spec:
      containers:
        - name: node8
          image: kevf20/tcp-node-metrics:latest
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 5000
            - containerPort: 8000
          env:
            - { name: SELF_NAME, value: "node8" }
            - { name: PORT, value: "5000" }
            - { name: METRICS_PORT, value: "8000" }
            - { name: PEERS, value: "node7,node6" }
            - { name: ROUTES, value: "node1:node6,node2:node6,node3:node6,node4:node6,node5:node6,node9:node7,node10:node7" }
          readinessProbe:
            tcpSocket: { port: 5000 }
            initialDelaySeconds: 3
            periodSeconds: 5
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: node9
  labels:
    app: node9
spec:
  replicas: 1
  selector:
    matchLabels: { app: node9 }
  template:
    metadata:
      labels: { app: node9 }
    spec:
      containers:
        - name: node9
          image: kevf20/tcp-node-metrics:latest
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 5000
            - containerPort: 8000
          env:
            - { name: SELF_NAME, value: "node9" }
            - { name: PORT, value: "5000" }
            - { name: METRICS_PORT, value: "8000" }
            - { name: PEERS, value: "node10,node5,node7" }
            - { name: DESTINOS, value: "node4" }
            - { name: ROUTES, value: "node1:node10,node2:node5,node3:node5,node4:node5,node6:node7,node8:node7" }
          readinessProbe:
            tcpSocket: { port: 5000 }
            initialDelaySeconds: 3
            periodSeconds: 5
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: node10
  labels:
    app: node10
spec:
  replicas: 1
  selector:
    matchLabels: { app: node10 }
  template:
    metadata:
      labels: { app: node10 }
    spec:
      containers:
        - name: node10
          image: kevf20/tcp-node-metrics:latest
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 5000
            - containerPort: 8000
          env:
            - { name: SELF_NAME, value: "node10" }
            - { name: PORT, value: "5000" }
            - { name: METRICS_PORT, value: "8000" }
            - { name: PEERS, value: "node2,node9" }
            - { name: ROUTES, value: "node1:node2,node4:node2,node3:node2,node5:node9,node6:node2,node7:node9,node8:node9" }
          readinessProbe:
            tcpSocket: { port: 5000 }
            initialDelaySeconds: 3
            periodSeconds: 5
